{% extends "base.html" %}
{% block title %}Auth Debug{% endblock %}

{% block content %}
<section class="section">
    <h2 class="section-title">üîß Auth Debug</h2>
    <p style="color: var(--text-dim); margin-bottom: 24px;">Use this page to find your Discord role IDs for staff access setup.</p>
    
    {% if not session %}
    <div class="empty-state">
        <h2>Not Logged In</h2>
        <p>Log in with Discord first to see your session data.</p>
        <a href="/auth/login" class="btn">Login with Discord</a>
    </div>
    {% else %}
    
    <!-- Your Session -->
    <div class="staff-card full-width" style="margin-bottom: 16px;">
        <h3>üë§ Your Session</h3>
        <div class="debug-grid">
            <div class="debug-row">
                <span class="debug-label">User ID</span>
                <span class="debug-value code">{{ session.id }}</span>
            </div>
            <div class="debug-row">
                <span class="debug-label">Username</span>
                <span class="debug-value">{{ session.username }}</span>
            </div>
            <div class="debug-row">
                <span class="debug-label">Staff Access</span>
                <span class="debug-value">
                    {% if session.is_staff %}
                    <span class="warn-active-badge" style="background: rgba(46,204,113,0.15); color: #2ecc71;">‚úÖ Granted</span>
                    {% else %}
                    <span class="warn-active-badge">‚ùå Denied</span>
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
    
    <!-- Your Role IDs (THE KEY INFO) -->
    <div class="staff-card full-width" style="margin-bottom: 16px;">
        <h3>üé≠ Your Discord Role IDs</h3>
        <p style="color: var(--text-dim); margin-bottom: 12px; font-size: 13px;">
            Copy the role IDs you want to grant staff access to and paste them into the 
            <code>STAFF_ROLE_IDS</code> environment variable on Render (comma-separated).
        </p>
        {% if session.role_ids %}
        <div class="role-ids-list">
            {% for role_id in session.role_ids %}
            <div class="role-id-row">
                <span class="code">{{ role_id }}</span>
                {% if role_id|string in (config.STAFF_ROLE_IDS or '') %}
                <span class="warn-active-badge" style="background: rgba(46,204,113,0.15); color: #2ecc71;">‚úì Staff role</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="empty-text">No role IDs found. Make sure GUILD_ID is set correctly and you're in the server.</p>
        {% endif %}
    </div>
    
    <!-- Server Config -->
    <div class="staff-card full-width" style="margin-bottom: 16px;">
        <h3>‚öôÔ∏è Environment Config</h3>
        <div class="debug-grid">
            {% for key, val in config.items() %}
            <div class="debug-row">
                <span class="debug-label">{{ key }}</span>
                <span class="debug-value code">{{ val }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Setup Instructions -->
    <div class="staff-card full-width">
        <h3>üìã How to Fix Staff Access</h3>
        <div style="font-size: 14px; color: var(--text); line-height: 1.8;">
            <p><strong>Step 1:</strong> Find your staff role ID from the list above.</p>
            <p><strong>Step 2:</strong> Go to Render ‚Üí your fallen-dashboard service ‚Üí Environment.</p>
            <p><strong>Step 3:</strong> Add or update <code>STAFF_ROLE_IDS</code> with your staff role IDs, comma-separated.</p>
            <p style="margin-left: 20px; color: var(--text-dim);">Example: <code>123456789,987654321</code></p>
            <p><strong>Step 4 (Emergency):</strong> Add <code>ADMIN_USER_IDS</code> with your Discord user ID: <code>{{ session.id }}</code></p>
            <p><strong>Step 5:</strong> Log out and log back in (sessions are cached ‚Äî you need a fresh login).</p>
        </div>
    </div>
    
    {% endif %}
</section>
{% endblock %}

{% extends "base.html" %}
{% block title %}Staff Dashboard{% endblock %}

{% block content %}
<section class="section">
    <h2 class="section-title">üõ°Ô∏è Staff Dashboard</h2>
    
    <div class="stat-grid compact">
        <div class="stat-card"><div class="stat-value">{{ (stats.total_users or 0)|fnum }}</div><div class="stat-label">Total Members</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_24h or 0)|fnum }}</div><div class="stat-label">Active Today</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_7d or 0)|fnum }}</div><div class="stat-label">Active This Week</div></div>
        <div class="stat-card"><div class="stat-value">{{ recent_warnings|length }}</div><div class="stat-label">Recent Warnings</div></div>
    </div>

    <div class="staff-grid">
        <div class="staff-card">
            <h3>üîç Member Lookup</h3>
            <form action="/staff/members" method="get" class="search-form">
                <input type="text" name="q" placeholder="Search Roblox username..." class="search-input">
                <button type="submit" class="btn btn-sm">Search</button>
            </form>
        </div>
        <div class="staff-card">
            <h3>üìù Open Positions</h3>
            {% if open_positions %}
            {% for pos in open_positions %}
            <div class="position-row"><span class="position-title">{{ pos.title }}</span><span class="position-status">Open</span></div>
            {% endfor %}
            {% else %}
            <p class="empty-text">No open positions.</p>
            {% endif %}
        </div>
    </div>

    <div class="staff-card full-width">
        <h3>‚ö†Ô∏è Recent Warnings</h3>
        {% if recent_warnings %}
        <table class="mini-table">
            <thead><tr><th>User</th><th>Category</th><th>Reason</th><th>Pts</th><th>Staff</th><th>Date</th></tr></thead>
            <tbody>
                {% for w in recent_warnings[:15] %}
                <tr>
                    <td><a href="/staff/member/{{ w.user_id }}">{{ w.user_id }}</a></td>
                    <td><span class="warn-cat">{{ w.category or 'general' }}</span></td>
                    <td class="td-reason">{{ (w.reason or '')[:60] }}{% if (w.reason or '')|length > 60 %}...{% endif %}</td>
                    <td>{{ w.points or 0 }}</td>
                    <td>{{ w.staff_id or '?' }}</td>
                    <td>{{ (w.timestamp or '')[:10] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="empty-text">No warnings data available. Sync warnings to PostgreSQL from the bot.</p>
        {% endif %}
    </div>
</section>
{% endblock %}

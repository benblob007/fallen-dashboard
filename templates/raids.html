{% extends "base.html" %}
{% block title %}Raids & Wars{% endblock %}
{% block content %}
<section class="section">
    <h2 class="section-title">Raids & Wars</h2>

    <!-- War Record Banner -->
    {% if war_record and war_record.total > 0 %}
    <div class="war-record-banner">
        <div class="war-record-stats">
            <div class="war-stat"><div class="war-stat-value text-green">{{ war_record.wins or 0 }}</div><div class="war-stat-label">Victories</div></div>
            <div class="war-stat"><div class="war-stat-value text-muted">{{ war_record.draws or 0 }}</div><div class="war-stat-label">Draws</div></div>
            <div class="war-stat"><div class="war-stat-value text-red">{{ war_record.losses or 0 }}</div><div class="war-stat-label">Defeats</div></div>
        </div>
        {% set total = war_record.total or 1 %}
        <div class="war-bar">
            <div class="war-bar-wins" style="width:{{ (war_record.wins/total*100)|int }}%"></div>
            {% if war_record.draws %}<div class="war-bar-draws" style="width:{{ (war_record.draws/total*100)|int }}%"></div>{% endif %}
            <div class="war-bar-losses" style="width:{{ (war_record.losses/total*100)|int }}%"></div>
        </div>
    </div>
    {% else %}
    <div class="war-record-banner empty">
        <div class="war-record-stats">
            <div class="war-stat"><div class="war-stat-value">0</div><div class="war-stat-label">Wars Fought</div></div>
        </div>
        <p class="text-muted" style="text-align:center;margin-top:8px;font-size:13px">No wars have been recorded yet. War data will appear here once clashes begin.</p>
    </div>
    {% endif %}

    <!-- Two Column: Top Raiders + Recent Wars -->
    <div class="raids-grid">
        <div class="raid-card">
            <h3 class="raid-card-title">üèÜ Top Raiders</h3>
            {% if raid_leaders %}
            <table class="mini-table">
                <thead><tr><th>#</th><th>Player</th><th>Raids</th><th>Won</th></tr></thead>
                <tbody>
                    {% for r in raid_leaders %}
                    <tr>
                        <td class="td-rank">{% if loop.index == 1 %}ü•á{% elif loop.index == 2 %}ü•à{% elif loop.index == 3 %}ü•â{% else %}{{ loop.index }}{% endif %}</td>
                        <td>{{ r.roblox_username or 'Unknown' }}</td>
                        <td>{{ r.raids_participated or r.raid_participation or 0 }}</td>
                        <td class="text-green">{{ r.raids_won or r.raid_wins or 0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state-sm">
                <p>No raid data yet.</p>
                <p class="text-muted">Complete raids to populate the leaderboard.</p>
            </div>
            {% endif %}
        </div>

        <div class="raid-card">
            <h3 class="raid-card-title">üè¥ Recent Wars</h3>
            {% if recent_wars %}
            <div class="war-list">
                {% for w in recent_wars %}
                <div class="war-item {{ w.status or '' }}">
                    <div class="war-item-opponent">vs {{ w.opponent_clan or 'Unknown' }}</div>
                    <div class="war-item-score">{{ w.our_score or 0 }}‚Äì{{ w.their_score or 0 }}</div>
                    <div class="war-item-status {{ w.status or 'pending' }}">{{ (w.status or 'pending')|upper }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state-sm">
                <p>No wars recorded yet.</p>
                <p class="text-muted">War results will appear here after clan wars.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Recent Raids Feed -->
    <div class="raid-card full-width">
        <h3 class="raid-card-title">‚ö° Recent Raids</h3>
        {% if recent_raids %}
        <div class="raid-feed">
            {% for r in recent_raids %}
            <div class="raid-feed-item {{ r.status or '' }}">
                <div class="raid-feed-type">{{ (r.raid_type or 'RAID')|upper }}</div>
                <div class="raid-feed-details">
                    {% if r.target %}<span class="raid-feed-target">vs {{ r.target }}</span>{% endif %}
                    <span class="raid-feed-score">{{ r.our_score or '?' }}‚Äì{{ r.their_score or '?' }}</span>
                </div>
                <div class="raid-feed-meta">{{ r.participant_count or 0 }} joined</div>
                <div class="raid-feed-status {{ r.status or '' }}">{{ (r.status or 'pending')|upper }}</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state-sm">
            <p>No raids recorded yet.</p>
            <p class="text-muted">Start a raid with the bot and results will appear here.</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

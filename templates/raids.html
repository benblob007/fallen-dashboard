{% extends "base.html" %}
{% block title %}Raids & Wars{% endblock %}

{% block content %}
<section class="section">
    <h2 class="section-title">üî• Raids & Wars</h2>
    
    <!-- War Record Banner -->
    {% if war_record and war_record.total > 0 %}
    <div class="war-banner">
        <div class="war-banner-title">Clan War Record</div>
        <div class="war-record-stats">
            <div class="war-stat win"><span class="war-stat-num">{{ war_record.wins }}</span><span class="war-stat-lbl">Wins</span></div>
            <div class="war-stat draw"><span class="war-stat-num">{{ war_record.draws }}</span><span class="war-stat-lbl">Draws</span></div>
            <div class="war-stat loss"><span class="war-stat-num">{{ war_record.losses }}</span><span class="war-stat-lbl">Losses</span></div>
        </div>
        <div class="war-record-bar">
            {% set total = war_record.total or 1 %}
            <div class="war-wins" style="width: {{ (war_record.wins / total * 100)|int }}%"></div>
            {% if war_record.draws > 0 %}
            <div class="war-draws" style="width: {{ (war_record.draws / total * 100)|int }}%"></div>
            {% endif %}
            <div class="war-losses" style="width: {{ (war_record.losses / total * 100)|int }}%"></div>
        </div>
    </div>
    {% endif %}

    <div class="raids-two-col">
        <!-- Top Raiders -->
        <div class="raid-section-card">
            <h3>üèÜ Top Raiders</h3>
            <table class="mini-table">
                <thead>
                    <tr><th>#</th><th>Raids</th><th>Won</th><th>MVP</th><th>XP Earned</th></tr>
                </thead>
                <tbody>
                    {% for r in raid_leaders %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><strong>{{ r.raids_participated }}</strong></td>
                        <td class="wins">{{ r.raids_won }}</td>
                        <td>{{ r.mvp_count or 0 }}</td>
                        <td>{{ (r.total_xp_earned or 0)|fnum }}</td>
                    </tr>
                    {% endfor %}
                    {% if not raid_leaders %}
                    <tr><td colspan="5" class="td-empty">No raid data yet.</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Recent Wars -->
        <div class="raid-section-card">
            <h3>üè¥ Recent Wars</h3>
            {% if recent_wars %}
            <div class="war-list">
                {% for w in recent_wars %}
                <div class="war-item {{ w.status }}">
                    <div class="war-opponent">vs {{ w.opponent_clan or 'Unknown' }}</div>
                    <div class="war-score">{{ w.our_score or 0 }} - {{ w.their_score or 0 }}</div>
                    <div class="war-status-badge">{{ w.status|upper }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty-text">No wars recorded yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- Recent Raids -->
    <div class="raid-section-card full-width">
        <h3>‚ö° Recent Raids</h3>
        {% if recent_raids %}
        <div class="raid-feed">
            {% for raid in recent_raids %}
            <div class="raid-item {{ raid.status or 'unknown' }}">
                <div class="raid-type-badge">{{ raid.raid_type|upper if raid.raid_type else 'RAID' }}</div>
                <div class="raid-details">
                    {% if raid.target %}
                    <span class="raid-target">vs {{ raid.target }}</span>
                    {% endif %}
                    <span class="raid-score">{{ raid.our_score or '?' }} - {{ raid.their_score or '?' }}</span>
                </div>
                <div class="raid-meta">
                    <span class="raid-participants">{{ raid.participant_count or 0 }} joined</span>
                    <span class="raid-date">{{ raid.created_at.strftime('%b %d') if raid.created_at else '' }}</span>
                </div>
                <div class="raid-status {{ raid.status or '' }}">{{ (raid.status or 'pending')|upper }}</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="empty-text">No raids recorded yet.</p>
        {% endif %}
    </div>
</section>
{% endblock %}

{% extends "base.html" %}
{% block title %}Duels & ELO{% endblock %}
{% block content %}
<section class="section">
    <h2 class="section-title">âš”ï¸ Duels & ELO Rankings</h2>

    <!-- ELO Distribution -->
    {% if elo_dist %}
    <div class="profile-section-card full-width" style="margin-bottom:20px">
        <h3>ğŸ“Š ELO Distribution</h3>
        <div class="dist-bars">
            {% set max_count = elo_dist.values()|max if elo_dist.values()|list else 1 %}
            {% for tier, count in elo_dist.items() %}
            <div class="dist-row">
                <span class="dist-label">{{ tier }}</span>
                <div class="dist-bar-wrap"><div class="dist-bar" style="width:{{ (count / max_count * 100)|int }}%"><span>{{ count }}</span></div></div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="raids-two-col">
        <!-- Top ELO -->
        <div class="raid-section-card">
            <h3>ğŸ† ELO Leaderboard</h3>
            <table class="mini-table">
                <thead><tr><th>#</th><th>Player</th><th>ELO</th><th>Rank</th><th>W/L</th></tr></thead>
                <tbody>
                    {% for p in elo_top[:10] %}
                    <tr>
                        <td>{% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif loop.index == 3 %}ğŸ¥‰{% else %}{{ loop.index }}{% endif %}</td>
                        <td>{{ p.roblox_username or 'Unknown' }}</td>
                        <td><strong>{{ p.elo_rating or 1000 }}</strong></td>
                        <td>{% set rn, re, rc = elo_rank(p.elo_rating or 1000) %}{{ re }} {{ rn }}</td>
                        <td><span class="wins">{{ p.wins or 0 }}</span>/<span class="losses">{{ p.losses or 0 }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Recent Matches -->
        <div class="raid-section-card">
            <h3>âš¡ Recent Matches</h3>
            {% if recent_duels %}
            <div class="duel-feed compact">
                {% for d in recent_duels[:15] %}
                <div class="duel-match">
                    <span class="duel-winner">ğŸ† {{ d.winner }}</span>
                    <span class="duel-vs">vs</span>
                    <span class="duel-loser">ğŸ’€ {{ d.loser }}</span>
                    <span class="duel-elo-shift">{{ d.winner_elo_after - d.winner_elo_before }}â†‘ / {{ d.loser_elo_after - d.loser_elo_before }}â†“</span>
                    <span class="duel-date">{{ d.completed_at|timeago }}</span>
                </div>
                {% endfor %}
            </div>
            {% else %}<p class="empty-text">No duel history yet.</p>{% endif %}
        </div>
    </div>
</section>
{% endblock %}

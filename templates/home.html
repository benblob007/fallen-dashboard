{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<section class="hero-accent">
    <h1 class="hero-title">THE FALLEN</h1>
    <p class="hero-subtitle">Rise from the shadows. Dominate the battlefield.</p>
    <div class="hero-stats">
        <div><div class="hero-stat-value">{{ (stats.total_users or 0)|fnum }}</div><div class="hero-stat-label">Members</div></div>
        <div><div class="hero-stat-value">{{ (stats.verified_users or 0)|fnum }}</div><div class="hero-stat-label">Verified</div></div>
        <div><div class="hero-stat-value">{{ (stats.active_24h or 0)|fnum }}</div><div class="hero-stat-label">Active Today</div></div>
    </div>
    {% if not user %}
    <a href="/auth/login" class="hero-cta">Login with Discord</a>
    {% else %}
    <a href="/profile" class="hero-cta">View Profile</a>
    {% endif %}
</section>

<section class="section">
    <h2 class="section-title">Server Overview</h2>
    <div class="stat-grid">
        <div class="stat-card accent"><div class="stat-value">{{ (stats.total_users or 0)|fnum }}</div><div class="stat-label">Members</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.verified_users or 0)|fnum }}</div><div class="stat-label">Verified</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_24h or 0)|fnum }}</div><div class="stat-label">Active Today</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_7d or 0)|fnum }}</div><div class="stat-label">Active 7d</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_messages or 0)|fnum }}</div><div class="stat-label">Messages</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_duels or 0)|fnum }}</div><div class="stat-label">Duels</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_raid_participations or 0)|fnum }}</div><div class="stat-label">Raid Joins</div></div>
        <div class="stat-card accent"><div class="stat-value">{{ stats.avg_level or 0 }}</div><div class="stat-label">Avg Level</div></div>
    </div>
</section>

<section class="section">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
        <h2 class="section-title" style="margin-bottom:0">Top Players</h2>
        <a href="/leaderboard" class="btn btn-sm btn-secondary">Full Leaderboard â†’</a>
    </div>
    {% if top_players and top_players|length >= 3 %}
    <div class="player-cards">
        <div class="player-card silver">
            <div class="medal">ðŸ¥ˆ</div>
            <img src="{{ top_players[1].avatar_url or 'https://cdn.discordapp.com/embed/avatars/1.png' }}" class="player-card-avatar" alt="">
            <div class="name">{{ top_players[1].roblox_username or 'Unknown' }}</div>
            <div class="score">Lvl {{ top_players[1].level or 0 }} Â· {{ (top_players[1].xp or 0)|fnum }} XP</div>
        </div>
        <div class="player-card gold">
            <div class="medal">ðŸ‘‘</div>
            <img src="{{ top_players[0].avatar_url or 'https://cdn.discordapp.com/embed/avatars/0.png' }}" class="player-card-avatar" alt="">
            <div class="name">{{ top_players[0].roblox_username or 'Unknown' }}</div>
            <div class="score">Lvl {{ top_players[0].level or 0 }} Â· {{ (top_players[0].xp or 0)|fnum }} XP</div>
        </div>
        <div class="player-card bronze">
            <div class="medal">ðŸ¥‰</div>
            <img src="{{ top_players[2].avatar_url or 'https://cdn.discordapp.com/embed/avatars/2.png' }}" class="player-card-avatar" alt="">
            <div class="name">{{ top_players[2].roblox_username or 'Unknown' }}</div>
            <div class="score">Lvl {{ top_players[2].level or 0 }} Â· {{ (top_players[2].xp or 0)|fnum }} XP</div>
        </div>
    </div>
    {% endif %}
    {% for p in top_players[3:] %}
    {% if loop.index <= 7 %}
    <div class="top-player-row">
        <span class="top-player-rank">#{{ loop.index + 3 }}</span>
        <img src="{{ p.avatar_url or 'https://cdn.discordapp.com/embed/avatars/' ~ (loop.index % 5) ~ '.png' }}" class="top-player-avatar" alt="">
        <span class="top-player-name">{{ p.roblox_username or 'Unknown' }}</span>
        <span class="top-player-stat">Lvl {{ p.level or 0 }}</span>
        <span class="top-player-stat">{{ (p.xp or 0)|fnum }} XP</span>
    </div>
    {% endif %}
    {% endfor %}
    {% if not top_players %}<div class="empty-state"><h3>No Players Yet</h3><p class="empty-text">Data will appear once the bot syncs.</p></div>{% endif %}
</section>

{% if war_record and war_record.total > 0 %}
<section class="section">
    <h2 class="section-title">War Record</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
        <div class="stat-card"><div class="stat-value" style="color:var(--success)">{{ war_record.wins or 0 }}W</div><div class="stat-label">Victories</div></div>
        <div class="stat-card"><div class="stat-value" style="color:var(--error)">{{ war_record.losses or 0 }}L</div><div class="stat-label">Defeats</div></div>
    </div>
    {% set total = war_record.total or 1 %}
    <div class="war-bar">
        <div class="war-bar-wins" style="width:{{ (war_record.wins / total * 100)|int }}%"></div>
        {% if war_record.draws %}<div class="war-bar-draws" style="width:{{ (war_record.draws / total * 100)|int }}%"></div>{% endif %}
        <div class="war-bar-losses" style="width:{{ (war_record.losses / total * 100)|int }}%"></div>
    </div>
</section>
{% endif %}
{% endblock %}

{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<section class="hero">
    <div class="hero-bg"></div>
    <div class="hero-content">
        <img src="/static/logo.svg" alt="The Fallen" class="hero-logo">
        <h1 class="hero-title">THE FALLEN</h1>
        <p class="hero-sub">Rise from the shadows. Dominate the battlefield.</p>
        {% if not user %}
        <a href="/auth/login" class="btn btn-hero btn-login">
            <svg width="20" height="15" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right:6px">
                <path d="M60.1 4.9A58.5 58.5 0 0045.4.2a.2.2 0 00-.2.1 40.8 40.8 0 00-1.8 3.7 54 54 0 00-16.2 0A37.4 37.4 0 0025.4.3a.2.2 0 00-.2-.1A58.4 58.4 0 0010.5 4.9a.2.2 0 00-.1.1A60 60 0 00.4 44.1a.2.2 0 00.1.2 58.7 58.7 0 0017.7 9 .2.2 0 00.3-.1 42 42 0 003.6-5.9.2.2 0 00-.1-.3 38.7 38.7 0 01-5.5-2.6.2.2 0 01 0-.4c.4-.3.8-.6 1.1-.9a.2.2 0 01.2 0 41.9 41.9 0 0035.6 0 .2.2 0 01.2 0l1.1.9a.2.2 0 010 .4c-1.8 1-3.6 1.9-5.5 2.6a.2.2 0 00-.1.3 47.2 47.2 0 003.6 5.9.2.2 0 00.3.1A58.5 58.5 0 0070.1 44.3a.2.2 0 00.1-.2c1.4-14.1-2.3-26.3-9.7-37.2a.2.2 0 00-.1 0zM23.7 36.3c-3.2 0-5.9-3-5.9-6.6s2.6-6.6 5.9-6.6c3.3 0 6 3 5.9 6.6 0 3.7-2.6 6.6-5.9 6.6zm21.8 0c-3.2 0-5.9-3-5.9-6.6s2.6-6.6 5.9-6.6c3.3 0 6 3 5.9 6.6 0 3.7-2.6 6.6-5.9 6.6z" fill="white"/>
            </svg>
            Login with Discord
        </a>
        {% endif %}
    </div>
</section>

<section class="section">
    <h2 class="section-title">Server Overview</h2>
    <div class="stat-grid">
        <div class="stat-card"><div class="stat-value">{{ (stats.total_users or 0)|fnum }}</div><div class="stat-label">Total Members</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.verified_users or 0)|fnum }}</div><div class="stat-label">Verified</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_24h or 0)|fnum }}</div><div class="stat-label">Active Today</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_7d or 0)|fnum }}</div><div class="stat-label">Active This Week</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_messages or 0)|fnum }}</div><div class="stat-label">Total Messages</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_duels or 0)|fnum }}</div><div class="stat-label">Duels Played</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_raid_participations or 0)|fnum }}</div><div class="stat-label">Raid Joins</div></div>
        <div class="stat-card accent"><div class="stat-value">{{ stats.avg_level or 0 }}</div><div class="stat-label">Average Level</div></div>
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h2 class="section-title">Top Players</h2>
        <a href="/leaderboard" class="btn btn-sm">View Full Leaderboard →</a>
    </div>
    <div class="top-players">
        {% for player in top_players %}
        <div class="player-card {% if loop.index == 1 %}first{% elif loop.index == 2 %}second{% elif loop.index == 3 %}third{% endif %}">
            <div class="player-rank">#{{ loop.index }}</div>
            <div class="player-info">
                <div class="player-name">
                    {{ player.roblox_username or 'Unknown' }}
                    {% if player.stage_rank %}<span class="stage-badge">⚔️ Rank {{ player.stage_rank }}</span>{% endif %}
                </div>
                <div class="player-stats">
                    <span>Lvl {{ player.level or 0 }}</span>
                    <span class="sep">·</span>
                    <span>{{ (player.xp or 0)|fnum }} XP</span>
                    <span class="sep">·</span>
                    <span>{{ player.elo_rating or 1000 }} ELO</span>
                </div>
            </div>
            <div class="player-level"><div class="level-badge">{{ player.level or 0 }}</div></div>
        </div>
        {% endfor %}
        {% if not top_players %}
        <p class="empty-text">No player data yet.</p>
        {% endif %}
    </div>
</section>

{% if war_record and war_record.total > 0 %}
<section class="section">
    <h2 class="section-title">War Record</h2>
    <div class="war-record-bar">
        {% set total = war_record.total or 1 %}
        <div class="war-wins" style="width: {{ (war_record.wins / total * 100)|int }}%">{{ war_record.wins }} W</div>
        {% if war_record.draws > 0 %}<div class="war-draws" style="width: {{ (war_record.draws / total * 100)|int }}%">{{ war_record.draws }} D</div>{% endif %}
        <div class="war-losses" style="width: {{ (war_record.losses / total * 100)|int }}%">{{ war_record.losses }} L</div>
    </div>
</section>
{% endif %}
{% endblock %}

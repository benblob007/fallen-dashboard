{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<section class="hero">
    <div class="hero-bg"></div>
    <div class="hero-content">
        <img src="/static/logo.svg" alt="The Fallen" class="hero-logo">
        <h1 class="hero-title">THE FALLEN</h1>
        <p class="hero-sub">Rise from the shadows. Dominate the battlefield.</p>
        {% if not user %}
        <a href="/auth/login" class="btn btn-hero">Login with Discord</a>
        {% endif %}
    </div>
</section>
<section class="section">
    <h2 class="section-title">Server Overview</h2>
    <div class="stat-grid">
        <div class="stat-card"><div class="stat-value">{{ (stats.total_users or 0)|fnum }}</div><div class="stat-label">Members</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.verified_users or 0)|fnum }}</div><div class="stat-label">Verified</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_24h or 0)|fnum }}</div><div class="stat-label">Active Today</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.active_7d or 0)|fnum }}</div><div class="stat-label">Active 7d</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_messages or 0)|fnum }}</div><div class="stat-label">Messages</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_duels or 0)|fnum }}</div><div class="stat-label">Duels</div></div>
        <div class="stat-card"><div class="stat-value">{{ (stats.total_raid_participations or 0)|fnum }}</div><div class="stat-label">Raid Joins</div></div>
        <div class="stat-card accent"><div class="stat-value">{{ stats.avg_level or 0 }}</div><div class="stat-label">Avg Level</div></div>
    </div>
</section>
<section class="section">
    <div class="section-header"><h2 class="section-title">Top Players</h2><a href="/leaderboard" class="btn btn-sm">Full Leaderboard →</a></div>
    <div class="top-players">
        {% for p in top_players %}
        <div class="player-card {% if loop.index == 1 %}first{% elif loop.index == 2 %}second{% elif loop.index == 3 %}third{% endif %}">
            <div class="player-rank">#{{ loop.index }}</div>
            <div class="player-info">
                <div class="player-name">{{ p.roblox_username or 'Unknown' }}{% if p.stage_rank %}<span class="stage-badge">⚔️ #{{ p.stage_rank }}</span>{% endif %}</div>
                <div class="player-stats"><span>Lvl {{ p.level or 0 }}</span><span class="sep">·</span><span>{{ (p.xp or 0)|fnum }} XP</span><span class="sep">·</span><span>{{ p.elo_rating or 1000 }} ELO</span></div>
            </div>
            <div class="player-level"><div class="level-badge">{{ p.level or 0 }}</div></div>
        </div>
        {% endfor %}
        {% if not top_players %}<p class="empty-text">No player data yet.</p>{% endif %}
    </div>
</section>
{% if war_record and war_record.total > 0 %}
<section class="section">
    <h2 class="section-title">War Record</h2>
    {% set total = war_record.total or 1 %}
    <div class="war-record-bar">
        <div class="war-wins" style="width:{{ (war_record.wins/total*100)|int }}%">{{ war_record.wins }}W</div>
        {% if war_record.draws %}<div class="war-draws" style="width:{{ (war_record.draws/total*100)|int }}%">{{ war_record.draws }}D</div>{% endif %}
        <div class="war-losses" style="width:{{ (war_record.losses/total*100)|int }}%">{{ war_record.losses }}L</div>
    </div>
</section>
{% endif %}
{% endblock %}

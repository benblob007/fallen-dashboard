{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<section class="hero">
    <div class="hero-bg"></div>
    <div class="hero-content">
        <h1 class="hero-title">✝ THE FALLEN ✝</h1>
        <p class="hero-sub">Rise from the shadows. Dominate the battlefield.</p>
        {% if not user %}
        <a href="/auth/login" class="btn btn-hero">Login with Discord</a>
        {% endif %}
    </div>
</section>

<section class="section">
    <h2 class="section-title">Server Overview</h2>
    
    <div class="stat-grid">
        <div class="stat-card">
            <div class="stat-value">{{ (stats.total_users or 0)|fnum }}</div>
            <div class="stat-label">Total Members</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ (stats.verified_users or 0)|fnum }}</div>
            <div class="stat-label">Verified</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ (stats.active_24h or 0)|fnum }}</div>
            <div class="stat-label">Active Today</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ (stats.active_7d or 0)|fnum }}</div>
            <div class="stat-label">Active This Week</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ (stats.total_messages or 0)|fnum }}</div>
            <div class="stat-label">Total Messages</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ (stats.total_duels or 0)|fnum }}</div>
            <div class="stat-label">Duels Played</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ (stats.total_raid_participations or 0)|fnum }}</div>
            <div class="stat-label">Raid Joins</div>
        </div>
        <div class="stat-card accent">
            <div class="stat-value">{{ (stats.avg_level or 0) }}</div>
            <div class="stat-label">Average Level</div>
        </div>
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h2 class="section-title">Top Players</h2>
        <a href="/leaderboard" class="btn btn-sm">View Full Leaderboard →</a>
    </div>
    
    <div class="top-players">
        {% for player in top_players %}
        <div class="player-card {% if loop.index == 1 %}first{% elif loop.index == 2 %}second{% elif loop.index == 3 %}third{% endif %}">
            <div class="player-rank">#{{ loop.index }}</div>
            <div class="player-info">
                <div class="player-name">{{ player.roblox_username or 'Unknown' }}</div>
                <div class="player-stats">
                    <span>Lvl {{ player.level }}</span>
                    <span class="sep">·</span>
                    <span>{{ player.xp|fnum }} XP</span>
                    <span class="sep">·</span>
                    <span>{{ player.elo_rating }} ELO</span>
                </div>
            </div>
            <div class="player-level">
                <div class="level-badge">{{ player.level }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

{% if war_record and war_record.total > 0 %}
<section class="section">
    <h2 class="section-title">War Record</h2>
    <div class="war-record-bar">
        {% set total = war_record.total or 1 %}
        <div class="war-wins" style="width: {{ (war_record.wins / total * 100)|int }}%">
            {{ war_record.wins }} W
        </div>
        {% if war_record.draws > 0 %}
        <div class="war-draws" style="width: {{ (war_record.draws / total * 100)|int }}%">
            {{ war_record.draws }} D
        </div>
        {% endif %}
        <div class="war-losses" style="width: {{ (war_record.losses / total * 100)|int }}%">
            {{ war_record.losses }} L
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

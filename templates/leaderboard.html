{% extends "base.html" %}
{% block title %}Leaderboard{% endblock %}

{% block content %}
<section class="section">
    <h2 class="section-title">Leaderboard</h2>
    
    <div class="lb-tabs">
        <a href="?sort=xp" class="lb-tab {% if sort == 'xp' %}active{% endif %}">XP</a>
        <a href="?sort=level" class="lb-tab {% if sort == 'level' %}active{% endif %}">Level</a>
        <a href="?sort=elo_rating" class="lb-tab {% if sort == 'elo_rating' %}active{% endif %}">ELO</a>
        <a href="?sort=coins" class="lb-tab {% if sort == 'coins' %}active{% endif %}">Coins</a>
        <a href="?sort=voice_time" class="lb-tab {% if sort == 'voice_time' %}active{% endif %}">Voice Time</a>
        <a href="?sort=messages" class="lb-tab {% if sort == 'messages' %}active{% endif %}">Messages</a>
        <a href="?sort=raid_participation" class="lb-tab {% if sort == 'raid_participation' %}active{% endif %}">Raids</a>
        <a href="?sort=weekly_xp" class="lb-tab {% if sort == 'weekly_xp' %}active{% endif %}">Weekly</a>
    </div>
    
    <div class="lb-table-wrap">
        <table class="lb-table">
            <thead>
                <tr>
                    <th class="th-rank">#</th>
                    <th class="th-name">Player</th>
                    <th>Stage</th>
                    <th>Level</th>
                    <th>XP</th>
                    <th>ELO</th>
                    <th>Coins</th>
                    <th>W/L</th>
                    <th>Raids</th>
                </tr>
            </thead>
            <tbody>
                {% for p in players %}
                <tr class="{% if loop.index + offset <= 3 %}top-three{% endif %}">
                    <td class="td-rank">
                        {% set pos = loop.index + offset %}
                        {% if pos == 1 %}ü•á{% elif pos == 2 %}ü•à{% elif pos == 3 %}ü•â{% else %}{{ pos }}{% endif %}
                    </td>
                    <td class="td-name">
                        <span class="player-verified">{% if p.verified %}‚úì{% endif %}</span>
                        {{ p.roblox_username or 'Unknown' }}
                    </td>
                    <td>
                        {% if p.stage_rank %}
                        <span class="stage-pill">‚öîÔ∏è {{ p.stage_rank }}</span>
                        {% else %}‚Äî{% endif %}
                    </td>
                    <td><span class="level-pill">{{ p.level or 0 }}</span></td>
                    <td>{{ (p.xp or 0)|fnum }}</td>
                    <td>
                        {% set rank_name, rank_emoji = elo_rank(p.elo_rating or 1000) %}
                        <span class="elo-badge" title="{{ rank_name }}">{{ rank_emoji }} {{ p.elo_rating or 1000 }}</span>
                    </td>
                    <td>{{ (p.coins or 0)|fnum }}</td>
                    <td class="td-wl">
                        <span class="wins">{{ p.wins or 0 }}</span>/<span class="losses">{{ p.losses or 0 }}</span>
                    </td>
                    <td>{{ p.raid_participation or 0 }}</td>
                </tr>
                {% endfor %}
                {% if not players %}
                <tr><td colspan="9" class="td-empty">No players found.</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <div class="pagination">
        {% if page > 1 %}
        <a href="?sort={{ sort }}&page={{ page - 1 }}" class="btn btn-sm">‚Üê Previous</a>
        {% endif %}
        <span class="page-info">Page {{ page }} ¬∑ {{ total_users|fnum }} players</span>
        {% if players|length == per_page %}
        <a href="?sort={{ sort }}&page={{ page + 1 }}" class="btn btn-sm">Next ‚Üí</a>
        {% endif %}
    </div>
</section>
{% endblock %}

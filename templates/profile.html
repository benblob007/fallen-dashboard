{% extends "base.html" %}
{% block title %}My Profile{% endblock %}

{% block content %}
<section class="section">
    {% if not profile %}
    <div class="empty-state">
        <h2>Profile Not Found</h2>
        <p>You haven't been tracked by the bot yet. Make sure you're verified in the Discord server and have some activity!</p>
        <a href="/" class="btn btn-sm">‚Üê Back Home</a>
    </div>
    {% else %}
    
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="profile-avatar-wrap">
            <img src="{{ user.avatar }}" alt="" class="profile-avatar">
            <div class="profile-level-badge">{{ profile.level }}</div>
        </div>
        <div class="profile-meta">
            <h1 class="profile-name">{{ user.username }}</h1>
            {% if profile.roblox_username %}
            <div class="profile-roblox">
                <span class="verified-check">{% if profile.verified %}‚úì Verified{% endif %}</span>
                Roblox: <strong>{{ profile.roblox_username }}</strong>
            </div>
            {% endif %}
            <div class="profile-ranks">
                <span class="rank-pill xp-rank">#{{ xp_rank }} XP</span>
                {% set rank_name, rank_emoji = elo_rank(profile.elo_rating or 1000) %}
                <span class="rank-pill elo-rank">{{ rank_emoji }} {{ rank_name }} ({{ profile.elo_rating or 1000 }})</span>
                <span class="rank-pill elo-pos">#{{ elo_rank_pos }} ELO</span>
            </div>
        </div>
    </div>

    <!-- XP Progress Bar -->
    <div class="xp-progress-section">
        <div class="xp-labels">
            <span>Level {{ profile.level }}</span>
            <span>{{ profile.xp|fnum }} XP</span>
            <span>Level {{ profile.level + 1 }}</span>
        </div>
        <div class="xp-bar-outer">
            <div class="xp-bar-inner" style="width: {{ level_progress(profile.xp or 0, profile.level or 0) }}%"></div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="profile-stats-grid">
        <div class="pstat-card">
            <div class="pstat-icon">üí¨</div>
            <div class="pstat-value">{{ (profile.messages or 0)|fnum }}</div>
            <div class="pstat-label">Messages</div>
        </div>
        <div class="pstat-card">
            <div class="pstat-icon">üéôÔ∏è</div>
            <div class="pstat-value">{{ (profile.voice_time or 0)|ftime }}</div>
            <div class="pstat-label">Voice Time</div>
        </div>
        <div class="pstat-card">
            <div class="pstat-icon">üí∞</div>
            <div class="pstat-value">{{ (profile.coins or 0)|fnum }}</div>
            <div class="pstat-label">FCoins</div>
        </div>
        <div class="pstat-card">
            <div class="pstat-icon">üî•</div>
            <div class="pstat-value">{{ profile.daily_streak or 0 }}</div>
            <div class="pstat-label">Daily Streak</div>
        </div>
    </div>

    <!-- Combat & Activity -->
    <div class="profile-two-col">
        <div class="profile-section-card">
            <h3>‚öîÔ∏è Combat</h3>
            <div class="combat-stats">
                <div class="combat-row">
                    <span class="combat-label">Duel W/L</span>
                    <span class="combat-value"><span class="wins">{{ profile.wins or 0 }}</span> / <span class="losses">{{ profile.losses or 0 }}</span></span>
                </div>
                <div class="combat-row">
                    <span class="combat-label">Raid W/L</span>
                    <span class="combat-value"><span class="wins">{{ profile.raid_wins or 0 }}</span> / <span class="losses">{{ profile.raid_losses or 0 }}</span></span>
                </div>
                <div class="combat-row">
                    <span class="combat-label">Raids Joined</span>
                    <span class="combat-value">{{ profile.raid_participation or 0 }}</span>
                </div>
                <div class="combat-row">
                    <span class="combat-label">ELO Rating</span>
                    <span class="combat-value">{{ profile.elo_rating or 1000 }}</span>
                </div>
            </div>
        </div>
        
        <div class="profile-section-card">
            <h3>üìÖ Attendance</h3>
            <div class="combat-stats">
                <div class="combat-row">
                    <span class="combat-label">Trainings</span>
                    <span class="combat-value">{{ profile.training_attendance or 0 }}</span>
                </div>
                <div class="combat-row">
                    <span class="combat-label">Tryouts Attended</span>
                    <span class="combat-value">{{ profile.tryout_attendance or 0 }}</span>
                </div>
                <div class="combat-row">
                    <span class="combat-label">Tryout Pass/Fail</span>
                    <span class="combat-value"><span class="wins">{{ profile.tryout_passes or 0 }}</span> / <span class="losses">{{ profile.tryout_fails or 0 }}</span></span>
                </div>
                <div class="combat-row">
                    <span class="combat-label">Events Hosted</span>
                    <span class="combat-value">{{ profile.events_hosted or 0 }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements -->
    {% if profile.achievements %}
    <div class="profile-section-card full-width">
        <h3>üèÖ Achievements</h3>
        <div class="achievements-grid">
            {% for ach in profile.achievements %}
            <div class="achievement-badge">{{ ach }}</div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Applications -->
    {% if applications %}
    <div class="profile-section-card full-width">
        <h3>üìù My Applications</h3>
        <div class="app-list">
            {% for app in applications %}
            <div class="app-row">
                <span class="app-position">{{ app.position_title or 'Position' }}</span>
                <span class="app-status status-{{ app.status }}">{{ app.status|title }}</span>
                <span class="app-date">{{ app.created_at.strftime('%b %d, %Y') if app.created_at else '' }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% endif %}
</section>
{% endblock %}
